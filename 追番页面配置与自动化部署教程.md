# Hexo åšå®¢è¿½ç•ªé¡µé¢é…ç½®ä¸è‡ªåŠ¨åŒ–éƒ¨ç½²æ•™ç¨‹

## ğŸ“‹ ç›®å½•
- [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
- [æ‰‹åŠ¨é…ç½®è¿½ç•ªé¡µé¢](#æ‰‹åŠ¨é…ç½®è¿½ç•ªé¡µé¢)
- [GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²](#github-actions-è‡ªåŠ¨åŒ–éƒ¨ç½²)
- [è¿½ç•ªåˆ—è¡¨ç®¡ç†](#è¿½ç•ªåˆ—è¡¨ç®¡ç†)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [é«˜çº§é…ç½®](#é«˜çº§é…ç½®)

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æœ¬æ•™ç¨‹å°†å¸®ä½ å®ç°ï¼š
- âœ… åŸºäº Bç«™æ•°æ®çš„è¿½ç•ªé¡µé¢
- âœ… GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²
- âœ… æœ¬åœ°ä¿®æ”¹ç›´æ¥å½±å“ç½‘ç«™æ˜¾ç¤º
- âœ… æ”¯æŒå¤šç§è¿½ç•ªçŠ¶æ€ç®¡ç†
- âœ… å“åº”å¼è®¾è®¡ï¼Œç§»åŠ¨ç«¯å‹å¥½

### å·¥ä½œæµç¨‹
```
Bç«™è¿½ç•ªåˆ—è¡¨ â†’ æœ¬åœ°é…ç½®ä¿®æ”¹ â†’ GitHub Push â†’ è‡ªåŠ¨éƒ¨ç½² â†’ ç½‘ç«™æ›´æ–°
     â†“              â†“              â†“           â†“          â†“
   æ•°æ®æº         é…ç½®æ–‡ä»¶        è§¦å‘æ„å»º     æœåŠ¡å™¨åŒæ­¥   ç”¨æˆ·è®¿é—®
```

## ğŸš€ æ‰‹åŠ¨é…ç½®è¿½ç•ªé¡µé¢

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…è¿½ç•ªæ’ä»¶

è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å®‰è£…æ’ä»¶ï¼š

```bash
# SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@74.48.157.54

# è¿›å…¥åšå®¢ç³»ç»Ÿç›®å½•
cd /opt/blog-system

# å®‰è£…è¿½ç•ªæ’ä»¶
npm install hexo-bilibili-bangumi --save
```

### ç¬¬äºŒæ­¥ï¼šé…ç½® _config.yml

åœ¨åšå®¢æ ¹ç›®å½•çš„ `_config.yml` æ–‡ä»¶æœ«å°¾æ·»åŠ è¿½ç•ªé…ç½®ï¼š

```yaml
# è¿½ç•ªæ’ä»¶é…ç½®
# https://github.com/HCLonely/hexo-bilibili-bangumi
bangumi: # è¿½ç•ªè®¾ç½®
  enable: true
  source: bili
  path:
  vmid: 372204786  # ä½ çš„Bç«™ç”¨æˆ·ID
  title: "è¿½ç•ªåˆ—è¡¨"
  quote: "ç”Ÿå‘½ä¸æ¯ï¼Œè¿½ç•ªä¸æ­¢ï¼"
  show: 1          # 1=å…¨éƒ¨, 2=æƒ³çœ‹, 3=åœ¨çœ‹, 4=çœ‹è¿‡
  lazyload: false
  loading:
  showMyComment: false
  pagination: false
  metaColor:
  color:
  webp:
  progress:
  extraOrder:
  proxy:
    host: "ä»£ç†host"
    port: "ä»£ç†ç«¯å£"
  extra_options:
    top_img: false
    lazyload:
      enable: false
```

### ç¬¬ä¸‰æ­¥ï¼šç”Ÿæˆè¿½ç•ªæ•°æ®

```bash
# è·å–Bç«™è¿½ç•ªæ•°æ®
hexo bangumi -u

# æ¸…ç†å¹¶é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶
hexo clean && hexo generate

# éƒ¨ç½²åˆ°ç½‘ç«™ç›®å½•
cp -r public/bangumis /var/www/blog/
chown -R deploy:deploy /var/www/blog/bangumis
```

### ç¬¬å››æ­¥ï¼šéªŒè¯éƒ¨ç½²

è®¿é—®è¿½ç•ªé¡µé¢ï¼š
- **HTTP**: http://myblog.xing2006.me/bangumis/
- **HTTPS**: https://blog.xing2006.me/bangumis/
- **IPç›´æ¥è®¿é—®**: http://74.48.157.54/bangumis/

## ğŸ¤– GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²

### é…ç½®è‡ªåŠ¨åŒ–è¿½ç•ªæ›´æ–°

åˆ›å»º `.github/workflows/update-bangumi.yml` æ–‡ä»¶ï¼š

```yaml
name: Update Bangumi & Deploy

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  
  # å®šæ—¶æ›´æ–°ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
  schedule:
    - cron: '0 2 * * *'
  
  # æ¨é€åˆ°mainåˆ†æ”¯æ—¶è§¦å‘
  push:
    branches: ["main", "master"]
    paths:
      - '_config.yml'
      - '_config.anzhiyu.yml'
      - 'source/**'

env:
  SSH_HOST: ${{ secrets.SSH_HOST }}
  SSH_USER: ${{ secrets.SSH_USER }}
  SSH_PORT: ${{ secrets.SSH_PORT }}
  TARGET_DIR: ${{ secrets.TARGET_DIR }}

jobs:
  update-bangumi-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: false

      # è®¾ç½® Node.js ç¯å¢ƒ
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: 'anzhiyu-blog/package-lock.json'

      # å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: |
          cd anzhiyu-blog
          npm ci

      # å®‰è£…è¿½ç•ªæ’ä»¶
      - name: Install bangumi plugin
        run: |
          cd anzhiyu-blog
          npm install hexo-bilibili-bangumi --save

      # æ›´æ–°è¿½ç•ªæ•°æ®
      - name: Update bangumi data
        run: |
          cd anzhiyu-blog
          npx hexo bangumi -u
        continue-on-error: true  # å³ä½¿è¿½ç•ªæ›´æ–°å¤±è´¥ä¹Ÿç»§ç»­æ„å»º

      # æ„å»ºåšå®¢
      - name: Build blog
        run: |
          cd anzhiyu-blog
          npm run clean && npm run build

      # éƒ¨ç½²åˆ°æœåŠ¡å™¨
      - name: Deploy to server
        uses: burnett01/rsync-deployments@6.0.0
        with:
          switches: -avzr --delete --exclude='.git*' --exclude='node_modules'
          path: anzhiyu-blog/public/
          remote_path: ${{ secrets.TARGET_DIR }}
          remote_host: ${{ secrets.SSH_HOST }}
          remote_port: ${{ secrets.SSH_PORT }}
          remote_user: ${{ secrets.SSH_USER }}
          remote_key: ${{ secrets.SSH_PRIVATE_KEY }}

      # å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
      - name: Notification
        if: success()
        run: |
          echo "âœ… è¿½ç•ªé¡µé¢æ›´æ–°å¹¶éƒ¨ç½²æˆåŠŸï¼"
          echo "ğŸŒ è®¿é—®åœ°å€: https://blog.xing2006.me/bangumis/"
```

### é…ç½® GitHub Secrets

åœ¨ GitHub ä»“åº“çš„ Settings â†’ Secrets and variables â†’ Actions ä¸­ç¡®ä¿å·²é…ç½®ï¼š

| å¯†é’¥åç§° | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|---------|------|--------|
| `SSH_HOST` | æœåŠ¡å™¨IPåœ°å€ | `74.48.157.54` |
| `SSH_USER` | SSHç”¨æˆ·å | `deploy` |
| `SSH_PORT` | SSHç«¯å£ | `22` |
| `TARGET_DIR` | ç›®æ ‡ç›®å½• | `/var/www/blog` |
| `SSH_PRIVATE_KEY` | SSHç§é’¥ | `-----BEGIN OPENSSH PRIVATE KEY-----...` |

## ğŸ“± è¿½ç•ªåˆ—è¡¨ç®¡ç†

### åœ¨Bç«™ä¿®æ”¹è¿½ç•ªåˆ—è¡¨

1. **ç™»å½•Bç«™è´¦å·**ï¼ˆç”¨æˆ·ID: 372204786ï¼‰
2. **è¿›å…¥ä¸ªäººç©ºé—´** â†’ **è¿½ç•ª/è¿½å‰§**é¡µé¢
3. **ç®¡ç†è¿½ç•ªçŠ¶æ€**ï¼š
   - æ·»åŠ ç•ªå‰§ï¼šæœç´¢ â†’ ç‚¹å‡»"è¿½ç•ª"
   - ç§»é™¤ç•ªå‰§ï¼šè¿½ç•ªåˆ—è¡¨ â†’ "å–æ¶ˆè¿½ç•ª"
   - ä¿®æ”¹çŠ¶æ€ï¼šæ ‡è®°ä¸º"æƒ³çœ‹"ã€"åœ¨çœ‹"ã€"çœ‹è¿‡"

### æœ¬åœ°é…ç½®ä¿®æ”¹

#### ä¿®æ”¹æ˜¾ç¤ºè®¾ç½®

ç¼–è¾‘ `anzhiyu-blog/_config.yml`ï¼š

```yaml
bangumi:
  enable: true
  vmid: 372204786
  title: "æˆ‘çš„è¿½ç•ªåˆ—è¡¨"        # è‡ªå®šä¹‰é¡µé¢æ ‡é¢˜
  quote: "äºŒæ¬¡å…ƒä¸–ç•Œï¼Œæ°¸è¿œçš„å®¶ï¼"  # è‡ªå®šä¹‰åº§å³é“­
  show: 1                     # 1=å…¨éƒ¨, 2=æƒ³çœ‹, 3=åœ¨çœ‹, 4=çœ‹è¿‡
  showMyComment: true         # æ˜¾ç¤ºä¸ªäººè¯„ä»·
  pagination: true            # å¯ç”¨åˆ†é¡µ
```

#### ä¿®æ”¹æ ·å¼é…ç½®

ç¼–è¾‘ `anzhiyu-blog/_config.anzhiyu.yml`ï¼š

```yaml
# è¿½ç•ªé¡µé¢æ ·å¼é…ç½®
bangumi:
  top_img: https://example.com/bangumi-bg.jpg  # è‡ªå®šä¹‰èƒŒæ™¯å›¾
  card_style: true                             # å¡ç‰‡æ ·å¼
  show_count: true                             # æ˜¾ç¤ºæ•°é‡ç»Ÿè®¡
```

### è‡ªåŠ¨åŒ–æ›´æ–°æµç¨‹

#### æ–¹æ³•ä¸€ï¼šæ¨é€è§¦å‘æ›´æ–°

```bash
# 1. ä¿®æ”¹é…ç½®æ–‡ä»¶
cd anzhiyu-blog
nano _config.yml  # æˆ– _config.anzhiyu.yml

# 2. æäº¤å¹¶æ¨é€
git add .
git commit -m "feat: æ›´æ–°è¿½ç•ªé¡µé¢é…ç½®"
git push origin main

# 3. GitHub Actions è‡ªåŠ¨æ‰§è¡Œï¼š
#    - æ›´æ–°Bç«™è¿½ç•ªæ•°æ®
#    - é‡æ–°æ„å»ºåšå®¢
#    - éƒ¨ç½²åˆ°æœåŠ¡å™¨
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨è§¦å‘æ›´æ–°

1. è®¿é—® GitHub ä»“åº“
2. ç‚¹å‡» **Actions** æ ‡ç­¾
3. é€‰æ‹© "Update Bangumi & Deploy" workflow
4. ç‚¹å‡» **Run workflow** æŒ‰é’®

#### æ–¹æ³•ä¸‰ï¼šå®šæ—¶è‡ªåŠ¨æ›´æ–°

é…ç½®æ–‡ä»¶ä¸­çš„å®šæ—¶ä»»åŠ¡ä¼šï¼š
- æ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨è¿è¡Œ
- è·å–æœ€æ–°çš„Bç«™è¿½ç•ªæ•°æ®
- é‡æ–°éƒ¨ç½²åˆ°ç½‘ç«™

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¿½ç•ªæ•°æ®è·å–å¤±è´¥

```bash
# æ£€æŸ¥Bç«™ç”¨æˆ·IDæ˜¯å¦æ­£ç¡®
# æ£€æŸ¥è¿½ç•ªåˆ—è¡¨æ˜¯å¦å…¬å¼€
# æ£€æŸ¥ç½‘ç»œè¿æ¥

# æ‰‹åŠ¨æµ‹è¯•
cd anzhiyu-blog
npx hexo bangumi -u --debug
```

#### 2. é¡µé¢æ˜¾ç¤ºå¼‚å¸¸

```bash
# æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
ls -la public/bangumis/

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/www/blog/bangumis/

# é‡æ–°ç”Ÿæˆ
hexo clean && hexo generate
```

#### 3. GitHub Actions å¤±è´¥

æ£€æŸ¥ Actions æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ï¼š
- SSH è¿æ¥é—®é¢˜
- ä¾èµ–å®‰è£…å¤±è´¥
- æ„å»ºè¿‡ç¨‹é”™è¯¯
- éƒ¨ç½²æƒé™é—®é¢˜

### è°ƒè¯•å‘½ä»¤

```bash
# æœ¬åœ°è°ƒè¯•
cd anzhiyu-blog
npm install hexo-bilibili-bangumi --save
npx hexo bangumi -u --debug
npx hexo generate --debug
npx hexo server

# æœåŠ¡å™¨è°ƒè¯•
ssh root@74.48.157.54
cd /opt/blog-system
tail -f /var/log/nginx/myblog.xing2006.me.access.log
```

## âš™ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰è¿½ç•ªé¡µé¢æ¨¡æ¿

åˆ›å»º `anzhiyu-blog/source/bangumis/index.md`ï¼š

```markdown
---
title: è¿½ç•ªåˆ—è¡¨
date: 2025-08-23 12:00:00
type: bangumis
top_img: https://example.com/bangumi-bg.jpg
comments: false
---

æ¬¢è¿æ¥åˆ°æˆ‘çš„è¿½ç•ªä¸–ç•Œï¼è¿™é‡Œè®°å½•äº†æˆ‘æ­£åœ¨è¿½çš„ç•ªå‰§å’Œå·²ç»çœ‹è¿‡çš„ç»å…¸ä½œå“ã€‚

<!-- è¿½ç•ªåˆ—è¡¨å°†è‡ªåŠ¨ç”Ÿæˆåœ¨è¿™é‡Œ -->
```

### å¤šç”¨æˆ·è¿½ç•ªæ”¯æŒ

```yaml
# æ”¯æŒå¤šä¸ªBç«™ç”¨æˆ·çš„è¿½ç•ª
bangumi:
  enable: true
  users:
    - vmid: 372204786
      name: "ä¸»è´¦å·"
      title: "æˆ‘çš„è¿½ç•ª"
    - vmid: 123456789
      name: "å¤‡ç”¨è´¦å·"
      title: "å¤‡ç”¨è¿½ç•ª"
```

### CDN åŠ é€Ÿé…ç½®

```yaml
# ä½¿ç”¨CDNåŠ é€Ÿç•ªå‰§å°é¢å›¾ç‰‡
bangumi:
  enable: true
  cdn:
    enable: true
    host: "https://cdn.example.com"
    path: "/bangumi/"
```

## ğŸ“Š ç›‘æ§å’Œç»Ÿè®¡

### è®¿é—®ç»Ÿè®¡

åœ¨ Google Analytics æˆ–å…¶ä»–ç»Ÿè®¡å·¥å…·ä¸­æ·»åŠ è¿½ç•ªé¡µé¢ç›‘æ§ï¼š

```javascript
// è¿½ç•ªé¡µé¢è®¿é—®ç»Ÿè®¡
gtag('config', 'GA_MEASUREMENT_ID', {
  page_title: 'è¿½ç•ªåˆ—è¡¨',
  page_location: 'https://blog.xing2006.me/bangumis/'
});
```

### è‡ªåŠ¨åŒ–æŠ¥å‘Š

åˆ›å»ºå®šæœŸæŠ¥å‘Šè„šæœ¬ï¼š

```bash
#!/bin/bash
# bangumi-report.sh
echo "=== è¿½ç•ªé¡µé¢çŠ¶æ€æŠ¥å‘Š ==="
echo "æ›´æ–°æ—¶é—´: $(date)"
echo "é¡µé¢è®¿é—®: $(curl -s https://blog.xing2006.me/bangumis/ | wc -c) bytes"
echo "è¿½ç•ªæ•°é‡: $(grep -o 'bangumi-item' /var/www/blog/bangumis/index.html | wc -l)"
```

---

## ğŸ“‹ å¿«é€Ÿæ“ä½œæŒ‡å—

### æ—¥å¸¸æ›´æ–°æµç¨‹

```bash
# 1. åœ¨Bç«™ä¿®æ”¹è¿½ç•ªåˆ—è¡¨
# 2. æœ¬åœ°ä¿®æ”¹é…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
git add _config.yml
git commit -m "update: è¿½ç•ªé…ç½®è°ƒæ•´"
git push origin main
# 3. ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²å®Œæˆ
# 4. è®¿é—® https://blog.xing2006.me/bangumis/ æŸ¥çœ‹ç»“æœ
```

### ç´§æ€¥ä¿®å¤æµç¨‹

```bash
# 1. æ‰‹åŠ¨è¿æ¥æœåŠ¡å™¨
ssh root@74.48.157.54
cd /opt/blog-system

# 2. æ‰‹åŠ¨æ›´æ–°
hexo bangumi -u
hexo clean && hexo generate
cp -r public/bangumis /var/www/blog/
chown -R deploy:deploy /var/www/blog/bangumis

# 3. éªŒè¯ä¿®å¤
curl -I https://blog.xing2006.me/bangumis/
```

## ğŸ¨ è‡ªå®šä¹‰æ ·å¼é…ç½®

### è¿½ç•ªé¡µé¢æ ·å¼å®šåˆ¶

åˆ›å»ºè‡ªå®šä¹‰CSSæ–‡ä»¶ `anzhiyu-blog/source/css/bangumi-custom.css`ï¼š

```css
/* è¿½ç•ªé¡µé¢è‡ªå®šä¹‰æ ·å¼ */
.bangumi-page {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
}

.bangumi-card {
  border-radius: 15px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.1);
  transition: transform 0.3s ease;
}

.bangumi-card:hover {
  transform: translateY(-5px);
}

.bangumi-status {
  background: linear-gradient(45deg, #ff6b6b, #feca57);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
}

.bangumi-progress {
  background: #e9ecef;
  border-radius: 10px;
  overflow: hidden;
}

.bangumi-progress-bar {
  background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
  height: 6px;
  transition: width 0.5s ease;
}
```

### å“åº”å¼è®¾è®¡é…ç½®

```css
/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  .bangumi-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }

  .bangumi-card {
    padding: 15px;
  }

  .bangumi-title {
    font-size: 14px;
    line-height: 1.4;
  }
}

@media (max-width: 480px) {
  .bangumi-grid {
    grid-template-columns: 1fr;
  }
}
```

## ğŸ”„ ç‰ˆæœ¬æ§åˆ¶ä¸å›æ»š

### é…ç½®ç‰ˆæœ¬ç®¡ç†

```bash
# åˆ›å»ºé…ç½®å¤‡ä»½åˆ†æ”¯
git checkout -b config-backup
git push origin config-backup

# åœ¨ä¸»åˆ†æ”¯è¿›è¡Œé…ç½®ä¿®æ”¹
git checkout main
# ä¿®æ”¹é…ç½®...
git add _config.yml
git commit -m "feat: è¿½ç•ªé¡µé¢é…ç½®ä¼˜åŒ–"
git push origin main
```

### å¿«é€Ÿå›æ»šæœºåˆ¶

```bash
# å¦‚æœæ–°é…ç½®æœ‰é—®é¢˜ï¼Œå¿«é€Ÿå›æ»š
git revert HEAD
git push origin main

# æˆ–è€…å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
git reset --hard <commit-hash>
git push --force origin main
```

### é…ç½®æ–‡ä»¶ç‰ˆæœ¬å¯¹æ¯”

```bash
# æŸ¥çœ‹é…ç½®æ–‡ä»¶å˜æ›´å†å²
git log --oneline -- _config.yml

# å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„é…ç½®
git diff HEAD~1 HEAD -- _config.yml

# æŸ¥çœ‹ç‰¹å®šæäº¤çš„é…ç½®å†…å®¹
git show <commit-hash>:_config.yml
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å›¾ç‰‡æ‡’åŠ è½½é…ç½®

```yaml
bangumi:
  enable: true
  lazyload: true
  loading: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2RkZCIvPgo8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iIGZpbGw9IiM5OTkiPkxvYWRpbmcuLi48L3RleHQ+Cjwvc3ZnPg=="
```

### CDN é…ç½®ä¼˜åŒ–

```yaml
bangumi:
  enable: true
  webp: true  # å¯ç”¨WebPæ ¼å¼
  proxy:      # ä½¿ç”¨ä»£ç†åŠ é€Ÿ
    host: "proxy.example.com"
    port: "8080"
```

### ç¼“å­˜ç­–ç•¥é…ç½®

åœ¨ Nginx é…ç½®ä¸­æ·»åŠ è¿½ç•ªé¡µé¢ç¼“å­˜ï¼š

```nginx
# è¿½ç•ªé¡µé¢ç¼“å­˜é…ç½®
location /bangumis/ {
    expires 1h;
    add_header Cache-Control "public, no-transform";

    # é™æ€èµ„æºé•¿æœŸç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|webp)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### API è®¿é—®é™åˆ¶

```yaml
bangumi:
  enable: true
  extra_options:
    rate_limit: 10        # æ¯åˆ†é’Ÿæœ€å¤š10æ¬¡è¯·æ±‚
    timeout: 30000        # 30ç§’è¶…æ—¶
    retry: 3              # å¤±è´¥é‡è¯•3æ¬¡
    user_agent: "Custom-Bangumi-Bot/1.0"
```

### æ•°æ®éªŒè¯é…ç½®

```yaml
bangumi:
  enable: true
  validation:
    min_score: 0          # æœ€ä½è¯„åˆ†
    max_score: 10         # æœ€é«˜è¯„åˆ†
    required_fields:      # å¿…éœ€å­—æ®µ
      - title
      - cover
      - url
```

## ğŸ“Š æ•°æ®åˆ†æä¸ç»Ÿè®¡

### è¿½ç•ªç»Ÿè®¡é…ç½®

```yaml
bangumi:
  enable: true
  statistics:
    enable: true
    show_total: true      # æ˜¾ç¤ºæ€»æ•°
    show_status: true     # æ˜¾ç¤ºå„çŠ¶æ€ç»Ÿè®¡
    show_rating: true     # æ˜¾ç¤ºè¯„åˆ†ç»Ÿè®¡
    show_year: true       # æ˜¾ç¤ºå¹´ä»½ç»Ÿè®¡
```

### è‡ªå®šä¹‰ç»Ÿè®¡é¡µé¢

åˆ›å»º `anzhiyu-blog/source/bangumi-stats/index.md`ï¼š

```markdown
---
title: è¿½ç•ªç»Ÿè®¡
date: 2025-08-23 12:00:00
type: bangumi-stats
---

## ğŸ“Š æˆ‘çš„è¿½ç•ªæ•°æ®

### æ€»ä½“ç»Ÿè®¡
- æ€»è¿½ç•ªæ•°ï¼š{{ bangumi.total }}
- å·²å®Œæˆï¼š{{ bangumi.finished }}
- æ­£åœ¨è¿½ï¼š{{ bangumi.watching }}
- è®¡åˆ’è§‚çœ‹ï¼š{{ bangumi.planned }}

### å¹´åº¦ç»Ÿè®¡
{% for year in bangumi.years %}
- {{ year.name }}ï¼š{{ year.count }} éƒ¨
{% endfor %}

### è¯„åˆ†åˆ†å¸ƒ
{% for rating in bangumi.ratings %}
- {{ rating.score }} åˆ†ï¼š{{ rating.count }} éƒ¨
{% endfor %}
```

## ğŸ”” é€šçŸ¥ä¸ç›‘æ§

### å¾®ä¿¡é€šçŸ¥é…ç½®

```yaml
# GitHub Actions ä¸­æ·»åŠ å¾®ä¿¡é€šçŸ¥
- name: WeChat Notification
  if: success()
  uses: chf007/action-wechat-work@master
  env:
    WECHAT_WORK_BOT_WEBHOOK: ${{ secrets.WECHAT_WEBHOOK }}
  with:
    msgtype: markdown
    content: |
      ## è¿½ç•ªé¡µé¢æ›´æ–°æˆåŠŸ âœ…

      **æ›´æ–°æ—¶é—´**: ${{ steps.date.outputs.date }}
      **è®¿é—®åœ°å€**: [https://blog.xing2006.me/bangumis/](https://blog.xing2006.me/bangumis/)
      **æ›´æ–°å†…å®¹**:
      - åŒæ­¥æœ€æ–°Bç«™è¿½ç•ªæ•°æ®
      - é‡æ–°ç”Ÿæˆé™æ€é¡µé¢
      - éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```

### é‚®ä»¶é€šçŸ¥é…ç½®

```yaml
- name: Email Notification
  if: failure()
  uses: dawidd6/action-send-mail@v3
  with:
    server_address: smtp.gmail.com
    server_port: 587
    username: ${{ secrets.EMAIL_USERNAME }}
    password: ${{ secrets.EMAIL_PASSWORD }}
    subject: "è¿½ç•ªé¡µé¢éƒ¨ç½²å¤±è´¥é€šçŸ¥"
    body: |
      è¿½ç•ªé¡µé¢è‡ªåŠ¨éƒ¨ç½²å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š
      1. Bç«™APIè®¿é—®æ˜¯å¦æ­£å¸¸
      2. æœåŠ¡å™¨è¿æ¥æ˜¯å¦æ­£å¸¸
      3. æ„å»ºè¿‡ç¨‹æ˜¯å¦æœ‰é”™è¯¯

      è¯¦ç»†æ—¥å¿—è¯·æŸ¥çœ‹ï¼š${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
    to: your-email@example.com
    from: noreply@yourdomain.com
```

## ğŸ§ª æµ‹è¯•ä¸éªŒè¯

### è‡ªåŠ¨åŒ–æµ‹è¯•é…ç½®

åˆ›å»º `.github/workflows/test-bangumi.yml`ï¼š

```yaml
name: Test Bangumi Page

on:
  pull_request:
    paths:
      - '_config.yml'
      - 'source/bangumis/**'

jobs:
  test-bangumi:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: 'anzhiyu-blog/package-lock.json'

      - name: Install dependencies
        run: |
          cd anzhiyu-blog
          npm ci
          npm install hexo-bilibili-bangumi --save

      - name: Test bangumi generation
        run: |
          cd anzhiyu-blog
          npx hexo bangumi -u --test
          npx hexo generate

      - name: Validate generated files
        run: |
          cd anzhiyu-blog
          test -f public/bangumis/index.html
          grep -q "bangumi-item" public/bangumis/index.html
          echo "âœ… è¿½ç•ªé¡µé¢ç”Ÿæˆæµ‹è¯•é€šè¿‡"
```

### æœ¬åœ°æµ‹è¯•è„šæœ¬

åˆ›å»º `test-bangumi.sh`ï¼š

```bash
#!/bin/bash
set -e

echo "ğŸ§ª å¼€å§‹è¿½ç•ªé¡µé¢æµ‹è¯•..."

cd anzhiyu-blog

# å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
npm install

# å®‰è£…è¿½ç•ªæ’ä»¶
echo "ğŸ”Œ å®‰è£…è¿½ç•ªæ’ä»¶..."
npm install hexo-bilibili-bangumi --save

# æµ‹è¯•è¿½ç•ªæ•°æ®è·å–
echo "ğŸ“¡ æµ‹è¯•è¿½ç•ªæ•°æ®è·å–..."
npx hexo bangumi -u --debug

# ç”Ÿæˆé™æ€æ–‡ä»¶
echo "ğŸ—ï¸ ç”Ÿæˆé™æ€æ–‡ä»¶..."
npx hexo clean && npx hexo generate

# éªŒè¯ç”Ÿæˆç»“æœ
echo "âœ… éªŒè¯ç”Ÿæˆç»“æœ..."
if [ -f "public/bangumis/index.html" ]; then
    echo "âœ… è¿½ç•ªé¡µé¢ç”ŸæˆæˆåŠŸ"

    # æ£€æŸ¥é¡µé¢å†…å®¹
    if grep -q "bangumi-item" public/bangumis/index.html; then
        echo "âœ… è¿½ç•ªæ•°æ®åŠ è½½æˆåŠŸ"
    else
        echo "âŒ è¿½ç•ªæ•°æ®åŠ è½½å¤±è´¥"
        exit 1
    fi
else
    echo "âŒ è¿½ç•ªé¡µé¢ç”Ÿæˆå¤±è´¥"
    exit 1
fi

# å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨æµ‹è¯•
echo "ğŸŒ å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨..."
npx hexo server --port 4000 &
SERVER_PID=$!

# ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
sleep 5

# æµ‹è¯•é¡µé¢è®¿é—®
echo "ğŸ” æµ‹è¯•é¡µé¢è®¿é—®..."
if curl -f http://localhost:4000/bangumis/ > /dev/null 2>&1; then
    echo "âœ… è¿½ç•ªé¡µé¢è®¿é—®æ­£å¸¸"
else
    echo "âŒ è¿½ç•ªé¡µé¢è®¿é—®å¤±è´¥"
    kill $SERVER_PID
    exit 1
fi

# æ¸…ç†
kill $SERVER_PID
echo "ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼"
```

## ğŸ“š å¸¸è§é—®é¢˜è§£ç­”

### Q1: è¿½ç•ªæ•°æ®ä¸æ›´æ–°æ€ä¹ˆåŠï¼Ÿ

**A1**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. Bç«™ç”¨æˆ·IDæ˜¯å¦æ­£ç¡®
2. è¿½ç•ªåˆ—è¡¨æ˜¯å¦è®¾ä¸ºå…¬å¼€
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. æ˜¯å¦è§¦å‘äº†Bç«™çš„åçˆ¬è™«æœºåˆ¶

```bash
# è°ƒè¯•å‘½ä»¤
cd anzhiyu-blog
npx hexo bangumi -u --debug --force
```

### Q2: é¡µé¢æ ·å¼æ˜¾ç¤ºå¼‚å¸¸ï¼Ÿ

**A2**: å¯èƒ½çš„åŸå› ï¼š
1. CSSæ–‡ä»¶ç¼“å­˜é—®é¢˜
2. ä¸»é¢˜ç‰ˆæœ¬ä¸å…¼å®¹
3. è‡ªå®šä¹‰æ ·å¼å†²çª

```bash
# æ¸…ç†ç¼“å­˜é‡æ–°ç”Ÿæˆ
hexo clean && hexo generate
# å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ç¼“å­˜ Ctrl+F5
```

### Q3: GitHub Actions éƒ¨ç½²å¤±è´¥ï¼Ÿ

**A3**: å¸¸è§è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ SSH å¯†é’¥é…ç½®
2. éªŒè¯æœåŠ¡å™¨è¿æ¥
3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

```bash
# æœ¬åœ°æµ‹è¯•SSHè¿æ¥
ssh -i ~/.ssh/id_rsa deploy@74.48.157.54
```

### Q4: å¦‚ä½•è‡ªå®šä¹‰è¿½ç•ªé¡µé¢å¸ƒå±€ï¼Ÿ

**A4**: ä¿®æ”¹ä¸»é¢˜æ¨¡æ¿æ–‡ä»¶ï¼š
1. å¤åˆ¶ `themes/anzhiyu/layout/bangumi.ejs`
2. ä¿®æ”¹ä¸ºè‡ªå®šä¹‰å¸ƒå±€
3. é‡æ–°ç”Ÿæˆéƒ¨ç½²

### Q5: æ”¯æŒå¤šä¸ªBç«™è´¦å·å—ï¼Ÿ

**A5**: ç›®å‰æ’ä»¶ä¸»è¦æ”¯æŒå•è´¦å·ï¼Œä½†å¯ä»¥é€šè¿‡é…ç½®å®ç°ï¼š

```yaml
bangumi:
  enable: true
  vmid: 372204786  # ä¸»è´¦å·
  extra_users:     # é¢å¤–è´¦å·ï¼ˆéœ€è¦è‡ªå®šä¹‰å®ç°ï¼‰
    - vmid: 123456789
      name: "å¤‡ç”¨è´¦å·"
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### åˆå§‹é…ç½®æ£€æŸ¥
- [ ] è¿½ç•ªæ’ä»¶å®‰è£…æˆåŠŸ
- [ ] _config.yml é…ç½®æ­£ç¡®
- [ ] Bç«™ç”¨æˆ·IDæœ‰æ•ˆ
- [ ] è¿½ç•ªåˆ—è¡¨å…¬å¼€å¯è®¿é—®
- [ ] é¦–æ¬¡æ•°æ®è·å–æˆåŠŸ
- [ ] é¡µé¢ç”Ÿæˆæ­£å¸¸
- [ ] éƒ¨ç½²åˆ°æœåŠ¡å™¨æˆåŠŸ

### GitHub Actions é…ç½®æ£€æŸ¥
- [ ] workflow æ–‡ä»¶åˆ›å»º
- [ ] GitHub Secrets é…ç½®å®Œæ•´
- [ ] SSH è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] è‡ªåŠ¨éƒ¨ç½²æµ‹è¯•æˆåŠŸ
- [ ] é€šçŸ¥é…ç½®æ­£å¸¸ï¼ˆå¯é€‰ï¼‰

### æ—¥å¸¸ç»´æŠ¤æ£€æŸ¥
- [ ] å®šæ—¶æ›´æ–°æ­£å¸¸è¿è¡Œ
- [ ] é¡µé¢è®¿é—®é€Ÿåº¦æ­£å¸¸
- [ ] ç§»åŠ¨ç«¯æ˜¾ç¤ºæ­£å¸¸
- [ ] æ•°æ®ç»Ÿè®¡å‡†ç¡®
- [ ] é”™è¯¯æ—¥å¿—ç›‘æ§

---

*æœ€åæ›´æ–°ï¼š2025å¹´8æœˆ23æ—¥*

> ğŸ’¡ **æ€»ç»“**: é€šè¿‡æœ¬æ•™ç¨‹ï¼Œä½ å¯ä»¥å®ç°å®Œå…¨è‡ªåŠ¨åŒ–çš„è¿½ç•ªé¡µé¢ç®¡ç†ã€‚åªéœ€è¦åœ¨Bç«™ç®¡ç†ä½ çš„è¿½ç•ªåˆ—è¡¨ï¼Œæˆ–è€…ä¿®æ”¹æœ¬åœ°é…ç½®æ–‡ä»¶å¹¶æ¨é€åˆ°GitHubï¼Œç½‘ç«™å°±ä¼šè‡ªåŠ¨æ›´æ–°ã€‚æ•´ä¸ªè¿‡ç¨‹æ— éœ€æ‰‹åŠ¨ç™»å½•æœåŠ¡å™¨ï¼ŒçœŸæ­£å®ç°äº†"ä¸€æ¬¡é…ç½®ï¼Œç»ˆèº«å—ç›Š"çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ä½“éªŒï¼

> ğŸš€ **ä¸‹ä¸€æ­¥**: å»ºè®®é…ç½®ç›‘æ§å’Œé€šçŸ¥åŠŸèƒ½ï¼Œè¿™æ ·ä½ å°±èƒ½åŠæ—¶äº†è§£éƒ¨ç½²çŠ¶æ€ï¼Œç¡®ä¿è¿½ç•ªé¡µé¢å§‹ç»ˆä¿æŒæœ€æ–°çŠ¶æ€ã€‚
